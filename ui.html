<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</title>
  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 16px;
      background: #ffffff;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .title {
      font-size: 14px;
      font-weight: 600;
      color: #000000;
      margin: 0;
    }
    
    .description {
      font-size: 12px;
      color: #666666;
      margin: 0;
      line-height: 1.4;
    }
    
    .selection-info {
      background: #f0f7ff;
      border: 1px solid #b3d9ff;
      border-radius: 6px;
      padding: 12px;
      font-size: 12px;
    }
    
    .selection-info.no-selection {
      background: #fff7f0;
      border-color: #ffcc99;
    }
    
    .selection-info.no-selection .info-title {
      color: #cc6600;
    }
    
    .info-title {
      font-weight: 600;
      color: #0066cc;
      margin-bottom: 4px;
    }
    
    .info-details {
      color: #666666;
      font-size: 11px;
    }
    
    .settings {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .setting-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .setting-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .setting-label {
      font-size: 12px;
      font-weight: 500;
      color: #333333;
    }
    
    .setting-input, .setting-select {
      padding: 8px 12px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      font-size: 12px;
      background: #ffffff;
      outline: none;
      transition: border-color 0.2s;
    }
    
    .setting-input:focus, .setting-select:focus {
      border-color: #0d99ff;
    }
    
    .setting-select {
      cursor: pointer;
    }
    
    .setting-select:disabled {
      background: #f5f5f5;
      color: #999999;
      cursor: not-allowed;
    }
    
    .grouping-section {
      background: #f9f9f9;
      border-radius: 6px;
      padding: 12px;
      border: 1px solid #e0e0e0;
    }
    
    .grouping-section.disabled {
      opacity: 0.6;
    }
    
    .section-title {
      font-size: 12px;
      font-weight: 600;
      color: #333333;
      margin-bottom: 8px;
    }
    
    .multi-select {
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      background: #ffffff;
      max-height: 120px;
      overflow-y: auto;
      padding: 4px;
    }
    
    .multi-select.disabled {
      background: #f5f5f5;
      border-color: #d0d0d0;
    }
    
    .property-option {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
      border-radius: 3px;
      transition: background-color 0.2s;
    }
    
    .property-option:hover {
      background: #f0f0f0;
    }
    
    .property-option.disabled {
      cursor: not-allowed;
      color: #999;
    }
    
    .property-option input[type="checkbox"] {
      margin: 0;
    }
    
    .group-info {
      font-size: 11px;
      color: #666;
      margin-top: 4px;
      font-style: italic;
    }
    
    .sorting-property {
      margin-bottom: 12px;
      padding: 8px;
      background: #f8f8f8;
      border-radius: 4px;
      border: 1px solid #e0e0e0;
    }
    
    .sorting-property-title {
      font-size: 12px;
      font-weight: 600;
      color: #333;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .property-visibility-toggle {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 10px;
      font-weight: normal;
      color: #666;
    }
    
    .property-visibility-toggle input[type="checkbox"] {
      margin: 0;
      transform: scale(0.8);
    }
    
    .sorting-values {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    .sorting-value {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 4px 8px;
      background: #ffffff;
      border: 1px solid #d0d0d0;
      border-radius: 3px;
      cursor: move;
      font-size: 11px;
    }
    
    .sorting-value:hover {
      background: #f0f7ff;
      border-color: #b3d9ff;
    }
    
    .sorting-value.dragging {
      opacity: 0.5;
    }
    
    .drag-handle {
      color: #999;
      cursor: move;
      font-size: 12px;
    }
    
    .sorting-order-number {
      background: #7B29E5;
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: bold;
    }
    
    .radio-group {
      display: flex;
      gap: 12px;
      margin-top: 4px;
    }
    
    .radio-option {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      cursor: pointer;
      color: #333333;
    }
    
    .radio-option input[type="radio"] {
      margin: 0;
      cursor: pointer;
    }
    
    .setting-row input[type="checkbox"] {
      margin: 0;
      cursor: pointer;
    }
    
    .refresh-btn {
      padding: 4px 8px;
      background: #f0f0f0;
      border: 1px solid #d0d0d0;
      border-radius: 4px;
      font-size: 11px;
      cursor: pointer;
      color: #666666;
      margin-left: 8px;
      transition: background-color 0.2s;
    }
    
    .refresh-btn:hover {
      background: #e0e0e0;
    }
    
    .refresh-btn:disabled {
      background: #f8f8f8;
      color: #cccccc;
      cursor: not-allowed;
    }
    
    .features {
      background: #f7f7f7;
      border-radius: 6px;
      padding: 12px;
      font-size: 12px;
      color: #333333;
    }
    
    .feature {
      margin: 4px 0;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .feature::before {
      content: "‚úì";
      color: #00aa00;
      font-weight: bold;
    }
    
    .buttons {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
    }
    
    .button-row {
      display: flex;
      gap: 8px;
    }
    
    .button {
      flex: 1;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .button-primary {
      background: #0d99ff;
      color: white;
    }
    
    .button-primary:hover {
      background: #0b7ce6;
    }
    
    .button-primary:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }
    
    .button-preset {
      background: #7B29E5;
      color: white;
      margin-bottom: 8px;
    }
    
    .button-preset:hover {
      background: #6A1FB3;
    }
    
    .button-preset:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }
    
    .button-secondary {
      background: #f0f0f0;
      color: #333333;
    }
    
    .button-secondary:hover {
      background: #e0e0e0;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è ComboInput –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ */
    .combo-input {
      position: relative;
      display: flex;
      align-items: center;
    }
    
    .combo-input-field {
      padding: 8px 32px 8px 12px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      font-size: 12px;
      background: #ffffff;
      outline: none;
      transition: border-color 0.2s;
      flex: 1;
      min-width: 0;
    }
    
    .combo-input-field:focus {
      border-color: #0d99ff;
    }
    
    .combo-dropdown-btn {
      position: absolute;
      right: 4px;
      top: 50%;
      transform: translateY(-50%);
      width: 24px;
      height: 24px;
      border: none;
      background: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: #666666;
      transition: color 0.2s;
      border-radius: 2px;
    }
    
    .combo-dropdown-btn:hover {
      background: #f0f0f0;
      color: #333333;
    }
    
    .combo-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      max-height: 200px;
      overflow-y: auto;
      display: none;
    }
    
    .combo-dropdown.open {
      display: block;
    }
    
    .combo-option {
      padding: 8px 12px;
      font-size: 12px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .combo-option:hover {
      background: #f0f7ff;
    }
    
    .combo-option:active {
      background: #e0f0ff;
    }
    
    .combo-option.selected {
      background: #0d99ff;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title">–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞</h1>
    
    <p class="description">
      –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–±–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (Component Set) –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ –Ω–∞–±–æ—Ä–∞, 
      –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –Ω–∞–∂–º–∏—Ç–µ "–í—ã—Ä–æ–≤–Ω—è—Ç—å".
    </p>
    
    <div class="selection-info" id="selection-info">
      <div class="info-title" id="info-title">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç</div>
      <div class="info-details" id="info-details">–í—ã–¥–µ–ª–∏—Ç–µ Component Set –∏–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ –Ω–∞–±–æ—Ä–∞</div>
    </div>
    
    <div class="settings">
      <div class="setting-group">
        <label class="setting-label" for="padding-input">–ü–∞–¥–¥–∏–Ω–≥ (px):</label>
        <div id="padding-input-container"></div>
      </div>
      
      <div class="setting-group">
        <label class="setting-label" for="spacing-input">–û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ (px):</label>
        <div id="spacing-input-container"></div>
      </div>
      
      <div class="setting-group">
        <label class="setting-label" for="column-spacing-input">–û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∫–æ–ª–æ–Ω–∫–∞–º–∏ (px):</label>
        <div id="column-spacing-input-container"></div>
      </div>
      
      <div class="setting-group">
        <label class="setting-label" for="group-spacing-input">–û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏ (px):</label>
        <div id="group-spacing-input-container"></div>
      </div>
      
      <div class="setting-group">
        <label class="setting-label" for="groups-per-row-input">–ú–∞–∫—Å–∏–º—É–º –≥—Ä—É–ø–ø –≤ —Å—Ç—Ä–æ–∫–µ:</label>
        <input 
          type="number" 
          id="groups-per-row-input" 
          class="setting-input" 
          value="3" 
          min="1" 
          max="10"
          placeholder="3"
        >
      </div>

      <div class="setting-group">
        <div class="setting-row">
          <input type="checkbox" id="show-annotations-checkbox" checked>
          <label class="setting-label" for="show-annotations-checkbox">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏</label>
        </div>
        <div class="group-info">–î–æ–±–∞–≤–ª—è—Ç—å –ø–æ–¥–ø–∏—Å–∏ –∫ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º, –∫–æ–ª–æ–Ω–∫–∞–º –∏ –≥—Ä—É–ø–ø–∞–º</div>
      </div>
      
      <div class="setting-group">
        <label class="setting-label" for="annotation-spacing-input">–û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π (px):</label>
        <div id="annotation-spacing-input-container"></div>
        <div class="group-info">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π</div>
      </div>
      
      <div class="setting-group">
        <label class="setting-label">–¢–∏–ø—ã –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π:</label>
        <div style="display: flex; flex-direction: column; gap: 6px; margin-top: 6px;">
          <div class="setting-row">
            <input type="checkbox" id="annotation-rows-checkbox" checked>
            <label class="setting-label" for="annotation-rows-checkbox">üìù –°—Ç—Ä–æ–∫–∏ (–≤–∞—Ä–∏–∞–Ω—Ç—ã)</label>
          </div>
          <div class="setting-row">
            <input type="checkbox" id="annotation-columns-checkbox" checked>
            <label class="setting-label" for="annotation-columns-checkbox">üìã –ö–æ–ª–æ–Ω–∫–∏</label>
          </div>
          <div class="setting-row">
            <input type="checkbox" id="annotation-groups-checkbox" checked>
            <label class="setting-label" for="annotation-groups-checkbox">üìÅ –ì—Ä—É–ø–ø—ã</label>
          </div>
        </div>
        <div class="group-info">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–∫–∏–µ —Ç–∏–ø—ã –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å</div>
      </div>
      
      <div class="setting-group">
        <label class="setting-label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –≤–Ω—É—Ç—Ä–∏ –≥—Ä—É–ø–ø:</label>
        <div class="radio-group">
          <label class="radio-option">
            <input type="radio" name="column-direction" value="horizontal" checked>
            <span>–ü–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="column-direction" value="vertical">
            <span>–ü–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏</span>
          </label>
        </div>
      </div>
    </div>
    
    <div class="grouping-section" id="grouping-section">
      <div class="section-title">
        –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–≤–æ–π—Å—Ç–≤–∞–º
        <button class="refresh-btn" id="refresh-properties-btn" disabled>–û–±–Ω–æ–≤–∏—Ç—å</button>
      </div>
      
      <div class="setting-group">
        <label class="setting-label">–°–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø:</label>
        <div class="multi-select disabled" id="group-properties-list">
          <div class="property-option disabled">
            <input type="checkbox" disabled>
            <span>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤</span>
          </div>
        </div>
        <div class="group-info" id="group-info">–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø –∫–æ–ª–æ–Ω–æ–∫</div>
      </div>
      
      <div class="setting-group">
        <label class="setting-label" for="column-property-select">–°–≤–æ–π—Å—Ç–≤–æ –¥–ª—è –∫–æ–ª–æ–Ω–æ–∫ –≤–Ω—É—Ç—Ä–∏ –≥—Ä—É–ø–ø:</label>
        <select id="column-property-select" class="setting-select" disabled>
          <option value="none">–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π—Å—Ç–≤–æ –¥–ª—è –∫–æ–ª–æ–Ω–æ–∫</option>
        </select>
      </div>
      
      <div class="setting-group">
        <div class="setting-row">
          <input type="checkbox" id="use-custom-sorting-checkbox">
          <label class="setting-label" for="use-custom-sorting-checkbox">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</label>
        </div>
        <div class="group-info">–ó–∞–¥–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π —Å–≤–æ–π—Å—Ç–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞</div>
        
        <div id="sorting-order-section" style="display: none; margin-top: 12px;">
          <div id="sorting-properties-list"></div>
        </div>
      </div>
    </div>
    
    <div class="features">
      <div class="feature">–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Å–≤–æ–π—Å—Ç–≤–∞–º</div>
      <div class="feature">–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫</div>
      <div class="feature">–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –æ—Ç—Å—Ç—É–ø—ã –º–µ–∂–¥—É –∫–æ–ª–æ–Ω–∫–∞–º–∏ –∏ –≥—Ä—É–ø–ø–∞–º–∏</div>
      <div class="feature">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–Ω–æ—Å –≥—Ä—É–ø–ø –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É</div>
      <div class="feature">–°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤–Ω—É—Ç—Ä–∏ –≥—Ä—É–ø–ø</div>
      <div class="feature">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–æ–≤</div>
      <div class="feature">–£–º–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Å –ª–∏–Ω–∏—è–º–∏ –≥—Ä–∞–Ω–∏—Ü –≥—Ä—É–ø–ø</div>
      <div class="feature">–ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª—è Accordion –∏ Alert –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</div>
    </div>
    
    <div class="buttons">
      <div id="platform-selector" style="display: none; margin-bottom: 12px;">
        <label class="setting-label">–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É:</label>
        <div class="radio-group" style="margin-top: 6px;">
          <label class="radio-option">
            <input type="radio" name="platform" value="Desktop" checked>
            <span>üñ•Ô∏è Desktop</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="platform" value="Mobile">
            <span>üì± Mobile</span>
          </label>
        </div>
      </div>
      <button class="button button-preset" id="preset-btn" disabled style="display: none;">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫—É</button>
      <button class="button button-secondary" id="copy-preset-btn" disabled>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ—Å–µ—Ç</button>
      <div class="button-row">
        <button class="button button-primary" id="align-btn" disabled>–í—ã—Ä–æ–≤–Ω—è—Ç—å</button>
        <button class="button button-secondary" id="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>

  <script>
    let availableProperties = [];
    let hasValidSelection = false;
    
    // –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è ComboInput
    const PRESET_VALUES = ['96', '80', '64', '48', '40', '32', '28', '24', '20', '16', '12', '8', '4', '2', '0'];
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è ComboInput –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    function createComboInput(inputId, defaultValue = '', placeholder = '') {
      const container = document.createElement('div');
      container.className = 'combo-input';
      
      const input = document.createElement('input');
      input.type = 'text';
      input.id = inputId;
      input.className = 'combo-input-field';
      input.value = defaultValue;
      input.placeholder = placeholder;
      
      const dropdownBtn = document.createElement('button');
      dropdownBtn.type = 'button';
      dropdownBtn.className = 'combo-dropdown-btn';
      dropdownBtn.innerHTML = '‚ñº';
      
      const dropdown = document.createElement('div');
      dropdown.className = 'combo-dropdown';
      
      // –°–æ–∑–¥–∞–µ–º –æ–ø—Ü–∏–∏ –¥–ª—è –¥—Ä–æ–ø–¥–∞—É–Ω–∞
      PRESET_VALUES.forEach(value => {
        const option = document.createElement('div');
        option.className = 'combo-option';
        option.dataset.value = value;
        option.textContent = value + 'px';
        dropdown.appendChild(option);
      });
      
      container.appendChild(input);
      container.appendChild(dropdownBtn);
      container.appendChild(dropdown);
      
      return container;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –¥–ª—è ComboInput
    function setupComboInputEvents(container) {
      const input = container.querySelector('.combo-input-field');
      const dropdownBtn = container.querySelector('.combo-dropdown-btn');
      const dropdown = container.querySelector('.combo-dropdown');
      const options = container.querySelectorAll('.combo-option');
      
      // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –¥—Ä–æ–ø–¥–∞—É–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É
      dropdownBtn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–∫—Ä—ã—Ç –ª–∏ —Ç–µ–∫—É—â–∏–π –¥—Ä–æ–ø–¥–∞—É–Ω
        const isCurrentOpen = dropdown.classList.contains('open');
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –¥—Ä–æ–ø–¥–∞—É–Ω—ã
        closeAllDropdowns();
        
        // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –¥—Ä–æ–ø–¥–∞—É–Ω –Ω–µ –±—ã–ª –æ—Ç–∫—Ä—ã—Ç, –æ—Ç–∫—Ä—ã–≤–∞–µ–º –µ–≥–æ
        if (!isCurrentOpen) {
          openDropdown(dropdown);
        }
      });
      
      // –û—Ç–∫—Ä—ã—Ç–∏–µ –¥—Ä–æ–ø–¥–∞—É–Ω–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ input
      input.addEventListener('focus', () => {
        closeAllDropdowns();
        openDropdown(dropdown);
      });
      
      // –í—ã–±–æ—Ä –æ–ø—Ü–∏–∏ –∏–∑ –¥—Ä–æ–ø–¥–∞—É–Ω–∞
      options.forEach(option => {
        option.addEventListener('click', (e) => {
          e.stopPropagation();
          const value = option.dataset.value;
          input.value = value;
          closeDropdown(dropdown);
          input.dispatchEvent(new Event('input', { bubbles: true }));
        });
      });
      
      // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞ - —Ä–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã
      input.addEventListener('input', (e) => {
        const value = e.target.value;
        // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä
        const numericValue = value.replace(/[^\d]/g, '');
        if (value !== numericValue) {
          e.target.value = numericValue;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤ –¥—Ä–æ–ø–¥–∞—É–Ω–µ
        updateDropdownSelection(container, numericValue);
      });
      
      // –†–∞–∑—Ä–µ—à–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é —Å—Ç—Ä–µ–ª–∫–∞–º–∏ –≤ –¥—Ä–æ–ø–¥–∞—É–Ω–µ
      input.addEventListener('keydown', (e) => {
        if (dropdown.classList.contains('open')) {
          if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
            e.preventDefault();
            navigateDropdown(dropdown, e.key === 'ArrowDown' ? 1 : -1);
          } else if (e.key === 'Enter') {
            e.preventDefault();
            const selectedOption = dropdown.querySelector('.combo-option.selected');
            if (selectedOption) {
              input.value = selectedOption.dataset.value;
              closeDropdown(dropdown);
              input.dispatchEvent(new Event('input', { bubbles: true }));
            }
          } else if (e.key === 'Escape') {
            closeDropdown(dropdown);
          }
        }
      });
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –¥—Ä–æ–ø–¥–∞—É–Ω–∞
    function openDropdown(dropdown) {
      dropdown.classList.add('open');
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –¥—Ä–æ–ø–¥–∞—É–Ω–∞
    function closeDropdown(dropdown) {
      dropdown.classList.remove('open');
      dropdown.querySelectorAll('.combo-option').forEach(opt => opt.classList.remove('selected'));
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥—Ä–æ–ø–¥–∞—É–Ω–∞
    function toggleDropdown(dropdown) {
      if (dropdown.classList.contains('open')) {
        closeDropdown(dropdown);
      } else {
        openDropdown(dropdown);
      }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –≤—Å–µ—Ö –¥—Ä–æ–ø–¥–∞—É–Ω–æ–≤
    function closeAllDropdowns() {
      document.querySelectorAll('.combo-dropdown').forEach(dropdown => {
        closeDropdown(dropdown);
      });
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤ –¥—Ä–æ–ø–¥–∞—É–Ω–µ
    function updateDropdownSelection(container, value) {
      const options = container.querySelectorAll('.combo-option');
      options.forEach(option => {
        option.classList.toggle('selected', option.dataset.value === value);
      });
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –¥—Ä–æ–ø–¥–∞—É–Ω—É —Å—Ç—Ä–µ–ª–∫–∞–º–∏
    function navigateDropdown(dropdown, direction) {
      const options = Array.from(dropdown.querySelectorAll('.combo-option'));
      const currentSelected = dropdown.querySelector('.combo-option.selected');
      let newIndex = 0;
      
      if (currentSelected) {
        const currentIndex = options.indexOf(currentSelected);
        newIndex = currentIndex + direction;
      } else if (direction > 0) {
        newIndex = 0;
      } else {
        newIndex = options.length - 1;
      }
      
      // –ó–∞—Ü–∏–∫–ª–∏–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
      if (newIndex < 0) newIndex = options.length - 1;
      if (newIndex >= options.length) newIndex = 0;
      
      options.forEach(opt => opt.classList.remove('selected'));
      options[newIndex].classList.add('selected');
    }
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –¥—Ä–æ–ø–¥–∞—É–Ω–æ–≤ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.combo-input')) {
        closeAllDropdowns();
      }
    });
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ UI
    function loadSettingsToUI(settings) {
      if (!settings) return;
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
      const paddingInput = document.getElementById('padding-input');
      if (paddingInput) paddingInput.value = settings.padding || 40;
      
      const spacingInput = document.getElementById('spacing-input');
      if (spacingInput) spacingInput.value = settings.spacing || 20;
      
      const columnSpacingInput = document.getElementById('column-spacing-input');
      if (columnSpacingInput) columnSpacingInput.value = settings.columnSpacing || 40;
      
      const groupSpacingInput = document.getElementById('group-spacing-input');
      if (groupSpacingInput) groupSpacingInput.value = settings.groupSpacing || 80;
      
      const groupsPerRowInput = document.getElementById('groups-per-row-input');
      if (groupsPerRowInput) groupsPerRowInput.value = settings.groupsPerRow || 3;
      
      const showAnnotationsCheckbox = document.getElementById('show-annotations-checkbox');
      if (showAnnotationsCheckbox) showAnnotationsCheckbox.checked = settings.showAnnotations !== false;
      
      const annotationSpacingInput = document.getElementById('annotation-spacing-input');
      if (annotationSpacingInput) annotationSpacingInput.value = settings.annotationSpacing || 24;
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫
      const columnDirectionRadios = document.querySelectorAll('input[name="column-direction"]');
      columnDirectionRadios.forEach(radio => {
        radio.checked = radio.value === (settings.columnDirection || 'horizontal');
      });
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –≥—Ä—É–ø–ø (–±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–æ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤–æ–π—Å—Ç–≤)
      window.pendingGroupProperties = settings.groupProperties || [];
      window.pendingColumnProperty = settings.columnProperty || null;
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
      window.pendingSortingOrder = settings.sortingOrder || null;
      window.pendingPropertyNamesVisibility = settings.propertyNamesVisibility || null;
      window.pendingAnnotationTypes = settings.annotationTypes || null;
      const customSortingCheckbox = document.getElementById('use-custom-sorting-checkbox');
      if (settings.sortingOrder && Object.keys(settings.sortingOrder).length > 0) {
        customSortingCheckbox.checked = true;
        document.getElementById('sorting-order-section').style.display = 'block';
      } else {
        customSortingCheckbox.checked = false;
        document.getElementById('sorting-order-section').style.display = 'none';
      }
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∏–ø–æ–≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π
      if (settings.annotationTypes) {
        document.getElementById('annotation-rows-checkbox').checked = settings.annotationTypes.rows !== false;
        document.getElementById('annotation-columns-checkbox').checked = settings.annotationTypes.columns !== false;
        document.getElementById('annotation-groups-checkbox').checked = settings.annotationTypes.groups !== false;
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
    function applyPendingGroupSettings() {
      // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –≥—Ä—É–ø–ø
      if (window.pendingGroupProperties && window.pendingGroupProperties.length > 0) {
        window.pendingGroupProperties.forEach(property => {
          const checkbox = document.getElementById(`group-prop-${property}`);
          if (checkbox) {
            checkbox.checked = true;
          }
        });
        updateGroupInfo();
      }
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫
      if (window.pendingColumnProperty) {
        const columnSelect = document.getElementById('column-property-select');
        columnSelect.value = window.pendingColumnProperty;
      }
      
             // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
       if (window.pendingSortingOrder) {
         updateSortingOrderUI(window.pendingSortingOrder);
       }
       
       // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–π —Å–≤–æ–π—Å—Ç–≤
       if (window.pendingPropertyNamesVisibility) {
         setTimeout(() => {
           Object.keys(window.pendingPropertyNamesVisibility).forEach(property => {
             const checkbox = document.getElementById(`show-name-${property}`);
             if (checkbox) {
               checkbox.checked = window.pendingPropertyNamesVisibility[property];
             }
           });
         }, 100);
       }
       
       // –û—á–∏—â–∞–µ–º –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
       window.pendingGroupProperties = null;
       window.pendingColumnProperty = null;
       window.pendingSortingOrder = null;
       window.pendingPropertyNamesVisibility = null;
       window.pendingAnnotationTypes = null;
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
    function loadPresetForPlatform(componentName, platform) {
      parent.postMessage({ 
        pluginMessage: { 
          type: 'get-preset-for-platform',
          componentName: componentName,
          platform: platform
        } 
      }, '*');
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤—ã–¥–µ–ª–µ–Ω–∏–∏
    function updateSelectionInfo(data) {
      const infoContainer = document.getElementById('selection-info');
      const infoTitle = document.getElementById('info-title');
      const infoDetails = document.getElementById('info-details');
      const groupingSection = document.getElementById('grouping-section');
      const alignBtn = document.getElementById('align-btn');
      const presetBtn = document.getElementById('preset-btn');
      const copyPresetBtn = document.getElementById('copy-preset-btn');
      const refreshBtn = document.getElementById('refresh-properties-btn');
      const groupPropertiesList = document.getElementById('group-properties-list');
      const columnPropertySelect = document.getElementById('column-property-select');
      
      hasValidSelection = data.hasValidSelection;
      
      if (data.hasValidSelection) {
        infoContainer.className = 'selection-info';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥—Ä—É–ø–ø–µ
        const presetStatus = data.preset ? ' ‚Ä¢ –µ—Å—Ç—å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞' : ' ‚Ä¢ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç';
        const groupStatus = data.group ? ` ‚Ä¢ –≥—Ä—É–ø–ø–∞: ${data.group.name}` : '';
        const platformsStatus = data.platforms && data.platforms.length > 0 ? ` ‚Ä¢ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã: ${data.platforms.join(', ')}` : '';
        infoTitle.textContent = `üì¶ ${data.componentSetName}${groupStatus}${platformsStatus}`;
        
        let detailsText = `${data.variantCount} –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ ‚Ä¢ ${data.properties.length} —Å–≤–æ–π—Å—Ç–≤${presetStatus}`;
        if (data.group && data.group.components.length > 1) {
          const otherComponents = data.group.components.filter(comp => comp !== data.componentSetName);
          if (otherComponents.length > 0) {
            detailsText += `\n–î—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≥—Ä—É–ø–ø—ã: ${otherComponents.join(', ')}`;
          }
        }
        
        groupingSection.classList.remove('disabled');
        alignBtn.disabled = false;
        copyPresetBtn.disabled = false;
        refreshBtn.disabled = false;
        groupPropertiesList.classList.remove('disabled');
        columnPropertySelect.disabled = false;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ
        const platformSelector = document.getElementById('platform-selector');
        if (data.platforms && data.platforms.length > 1) {
          platformSelector.style.display = 'block';
          // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–∫–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
          const platformRadios = document.querySelectorAll('input[name="platform"]');
          platformRadios.forEach(radio => {
            radio.style.display = data.platforms.includes(radio.value) ? 'inline' : 'none';
            radio.parentElement.style.display = data.platforms.includes(radio.value) ? 'flex' : 'none';
            if (data.platforms.includes(radio.value) && radio.value === 'Desktop') {
              radio.checked = true; // Desktop –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            }
          });
        } else {
          platformSelector.style.display = 'none';
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ > –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏
        if (data.savedSettings) {
          // –ï—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å
          loadSettingsToUI(data.savedSettings);
          // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –æ–ø–∏—Å–∞–Ω–∏–∏
          detailsText += ' ‚Ä¢ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã';
        } else if (data.preset) {
          // –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫, –Ω–æ –µ—Å—Ç—å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞
          loadSettingsToUI(data.preset);
        }
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–π —Ç–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è
        infoDetails.textContent = detailsText;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞
        if (data.preset) {
          presetBtn.style.display = 'block';
          presetBtn.disabled = false;
        } else {
          presetBtn.style.display = 'none';
        }
        
        updatePropertiesControls(data.properties);
      } else {
        infoContainer.className = 'selection-info no-selection';
        infoTitle.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç';
        infoDetails.textContent = '–í—ã–¥–µ–ª–∏—Ç–µ Component Set –∏–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ –Ω–∞–±–æ—Ä–∞';
        
        groupingSection.classList.add('disabled');
        alignBtn.disabled = true;
        copyPresetBtn.disabled = true;
        presetBtn.style.display = 'none';
        document.getElementById('platform-selector').style.display = 'none';
        refreshBtn.disabled = true;
        groupPropertiesList.classList.add('disabled');
        columnPropertySelect.disabled = true;
        
        updatePropertiesControls([]);
      }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ —Å–≤–æ–π—Å—Ç–≤
    function updatePropertiesControls(properties) {
      const groupPropertiesList = document.getElementById('group-properties-list');
      const columnPropertySelect = document.getElementById('column-property-select');
      const groupInfo = document.getElementById('group-info');
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–≤–æ–π—Å—Ç–≤ –¥–ª—è –≥—Ä—É–ø–ø
      groupPropertiesList.innerHTML = '';
      
      if (properties.length === 0) {
        const option = document.createElement('div');
        option.className = 'property-option disabled';
        option.innerHTML = '<input type="checkbox" disabled><span>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤</span>';
        groupPropertiesList.appendChild(option);
        groupInfo.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–≤–æ–π—Å—Ç–≤';
      } else {
        properties.forEach(property => {
          const option = document.createElement('div');
          option.className = 'property-option';
          option.innerHTML = `
            <input type="checkbox" id="group-prop-${property}" value="${property}">
            <label for="group-prop-${property}">${property}</label>
          `;
          groupPropertiesList.appendChild(option);
          
          // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è
          const checkbox = option.querySelector('input');
          checkbox.addEventListener('change', updateGroupInfo);
        });
        groupInfo.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø –∫–æ–ª–æ–Ω–æ–∫';
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç —Å–≤–æ–π—Å—Ç–≤ –¥–ª—è –∫–æ–ª–æ–Ω–æ–∫
      while (columnPropertySelect.children.length > 1) {
        columnPropertySelect.removeChild(columnPropertySelect.lastChild);
      }
      
      properties.forEach(property => {
        const option = document.createElement('option');
        option.value = property;
        option.textContent = property;
        columnPropertySelect.appendChild(option);
      });
      
      availableProperties = properties;
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
      applyPendingGroupSettings();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥—Ä—É–ø–ø–∞—Ö
    function updateGroupInfo() {
      const groupInfo = document.getElementById('group-info');
      const selectedProperties = getSelectedGroupProperties();
      
      if (selectedProperties.length === 0) {
        groupInfo.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø –∫–æ–ª–æ–Ω–æ–∫';
      } else {
        groupInfo.textContent = `–í—ã–±—Ä–∞–Ω–æ —Å–≤–æ–π—Å—Ç–≤ –¥–ª—è –≥—Ä—É–ø–ø: ${selectedProperties.join(', ')}`;
      }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤ –¥–ª—è –≥—Ä—É–ø–ø
    function getSelectedGroupProperties() {
      const checkboxes = document.querySelectorAll('#group-properties-list input[type="checkbox"]:checked');
      return Array.from(checkboxes).map(cb => cb.value);
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI –ø–æ—Ä—è–¥–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
    function updateSortingOrderUI(sortingOrder) {
      const container = document.getElementById('sorting-properties-list');
      container.innerHTML = '';
      
      if (!sortingOrder || Object.keys(sortingOrder).length === 0) {
        container.innerHTML = '<div class="group-info">–í–∫–ª—é—á–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø–æ—Ä—è–¥–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</div>';
        return;
      }
      
      Object.keys(sortingOrder).forEach(property => {
        const propertyDiv = document.createElement('div');
        propertyDiv.className = 'sorting-property';
        
        const title = document.createElement('div');
        title.className = 'sorting-property-title';
        
        const titleText = document.createElement('span');
        titleText.textContent = `–°–≤–æ–π—Å—Ç–≤–æ: ${property}`;
        title.appendChild(titleText);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤–∞
        const visibilityToggle = document.createElement('label');
        visibilityToggle.className = 'property-visibility-toggle';
        
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.id = `show-name-${property}`;
        checkbox.dataset.property = property;
        checkbox.checked = true; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ
        
        const label = document.createElement('span');
        label.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ';
        
        visibilityToggle.appendChild(checkbox);
        visibilityToggle.appendChild(label);
        title.appendChild(visibilityToggle);
        
        propertyDiv.appendChild(title);
        
        const valuesContainer = document.createElement('div');
        valuesContainer.className = 'sorting-values';
        valuesContainer.dataset.property = property;
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –ø–æ—Ä—è–¥–∫—É
        const values = Object.keys(sortingOrder[property]).sort((a, b) => {
          return sortingOrder[property][a] - sortingOrder[property][b];
        });
        
        values.forEach((value, index) => {
          const valueDiv = document.createElement('div');
          valueDiv.className = 'sorting-value';
          valueDiv.draggable = true;
          valueDiv.dataset.value = value;
          
          const orderNumber = document.createElement('div');
          orderNumber.className = 'sorting-order-number';
          orderNumber.textContent = index + 1;
          
          const dragHandle = document.createElement('span');
          dragHandle.className = 'drag-handle';
          dragHandle.textContent = '‚ãÆ‚ãÆ';
          
          const valueText = document.createElement('span');
          valueText.textContent = value;
          
          valueDiv.appendChild(orderNumber);
          valueDiv.appendChild(dragHandle);
          valueDiv.appendChild(valueText);
          
          // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ drag and drop
          valueDiv.addEventListener('dragstart', handleDragStart);
          valueDiv.addEventListener('dragover', handleDragOver);
          valueDiv.addEventListener('drop', handleDrop);
          valueDiv.addEventListener('dragend', handleDragEnd);
          
          valuesContainer.appendChild(valueDiv);
        });
        
        propertyDiv.appendChild(valuesContainer);
        container.appendChild(propertyDiv);
      });
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ—Ä—è–¥–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏–∑ UI
    function getSortingOrderFromUI() {
      if (!document.getElementById('use-custom-sorting-checkbox').checked) {
        return null;
      }
      
      const sortingOrder = {};
      const propertyContainers = document.querySelectorAll('.sorting-values');
      
      propertyContainers.forEach(container => {
        const property = container.dataset.property;
        const values = container.querySelectorAll('.sorting-value');
        
        sortingOrder[property] = {};
        values.forEach((valueDiv, index) => {
          const value = valueDiv.dataset.value;
          sortingOrder[property][value] = index + 1;
        });
      });
      
      return Object.keys(sortingOrder).length > 0 ? sortingOrder : null;
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–π –∏–∑ UI
    function getPropertyNamesVisibilityFromUI() {
      if (!document.getElementById('use-custom-sorting-checkbox').checked) {
        return null;
      }
      
      const propertyNamesVisibility = {};
      const checkboxes = document.querySelectorAll('input[id^="show-name-"]');
      
      checkboxes.forEach(checkbox => {
        const property = checkbox.dataset.property;
        propertyNamesVisibility[property] = checkbox.checked;
      });
      
             return Object.keys(propertyNamesVisibility).length > 0 ? propertyNamesVisibility : null;
     }

     // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–∏–ø–æ–≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π –∏–∑ UI
     function getAnnotationTypesFromUI() {
       return {
         rows: document.getElementById('annotation-rows-checkbox').checked,
         columns: document.getElementById('annotation-columns-checkbox').checked,
         groups: document.getElementById('annotation-groups-checkbox').checked
       };
     }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ drag and drop
    let draggedElement = null;
    
    function handleDragStart(e) {
      draggedElement = e.target;
      e.target.classList.add('dragging');
    }
    
    function handleDragOver(e) {
      e.preventDefault();
    }
    
    function handleDrop(e) {
      e.preventDefault();
      
      if (draggedElement && e.target.classList.contains('sorting-value') && draggedElement !== e.target) {
        const container = e.target.parentNode;
        const draggedIndex = Array.from(container.children).indexOf(draggedElement);
        const targetIndex = Array.from(container.children).indexOf(e.target);
        
        if (draggedIndex < targetIndex) {
          container.insertBefore(draggedElement, e.target.nextSibling);
        } else {
          container.insertBefore(draggedElement, e.target);
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–æ–º–µ—Ä–∞ –ø–æ—Ä—è–¥–∫–∞
        updateOrderNumbers(container);
      }
    }
    
    function handleDragEnd(e) {
      e.target.classList.remove('dragging');
      draggedElement = null;
    }
    
    function updateOrderNumbers(container) {
      const values = container.querySelectorAll('.sorting-value');
      values.forEach((valueDiv, index) => {
        const orderNumber = valueDiv.querySelector('.sorting-order-number');
        orderNumber.textContent = index + 1;
      });
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    document.getElementById('preset-btn').addEventListener('click', () => {
      if (!hasValidSelection) {
        return;
      }
      
      // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –µ—Å–ª–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä –≤–∏–¥–∏–º—ã–π
      const platformSelector = document.getElementById('platform-selector');
      let selectedPlatform = null;
      if (platformSelector.style.display !== 'none') {
        const selectedRadio = document.querySelector('input[name="platform"]:checked');
        selectedPlatform = selectedRadio ? selectedRadio.value : null;
      }
      
      parent.postMessage({ 
        pluginMessage: { 
          type: 'apply-preset',
          platform: selectedPlatform
        } 
      }, '*');
    });
    
    document.getElementById('align-btn').addEventListener('click', () => {
      if (!hasValidSelection) {
        return;
      }
      
      const paddingInput = document.getElementById('padding-input');
      const spacingInput = document.getElementById('spacing-input');
      const columnSpacingInput = document.getElementById('column-spacing-input');
      const groupSpacingInput = document.getElementById('group-spacing-input');
      const annotationSpacingInput = document.getElementById('annotation-spacing-input');
      
      const padding = parseInt(paddingInput ? paddingInput.value : '40') || 40;
      const spacing = parseInt(spacingInput ? spacingInput.value : '20') || 20;
      const columnSpacing = parseInt(columnSpacingInput ? columnSpacingInput.value : '40') || 40;
      const groupSpacing = parseInt(groupSpacingInput ? groupSpacingInput.value : '80') || 80;
      const groupsPerRow = parseInt(document.getElementById('groups-per-row-input').value) || 3;
      const columnDirection = document.querySelector('input[name="column-direction"]:checked').value;
      const groupProperties = getSelectedGroupProperties();
      const columnProperty = document.getElementById('column-property-select').value;
      const showAnnotations = document.getElementById('show-annotations-checkbox').checked;
      const annotationSpacing = parseInt(annotationSpacingInput ? annotationSpacingInput.value : '24') || 24;
        const sortingOrder = getSortingOrderFromUI();
        const propertyNamesVisibility = getPropertyNamesVisibilityFromUI();
        const annotationTypes = getAnnotationTypesFromUI();
        
        parent.postMessage({ 
        pluginMessage: { 
          type: 'align-variants',
          padding: padding,
          spacing: spacing,
          columnSpacing: columnSpacing,
          groupSpacing: groupSpacing,
          groupsPerRow: groupsPerRow,
          columnDirection: columnDirection,
          groupProperties: groupProperties,
          columnProperty: columnProperty === 'none' ? null : columnProperty,
          showAnnotations: showAnnotations,
          annotationSpacing: annotationSpacing,
          sortingOrder: sortingOrder,
          propertyNamesVisibility: propertyNamesVisibility,
          annotationTypes: annotationTypes
        } 
      }, '*');
    });
    
    document.getElementById('copy-preset-btn').addEventListener('click', () => {
      if (!hasValidSelection) {
        return;
      }
      
      if (!window.currentComponentName) {
        parent.postMessage({
          pluginMessage: {
            type: 'show-notification',
            message: '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–µ—Å–µ—Ç–∞'
          }
        }, '*');
        return;
      }
      
      const paddingInput = document.getElementById('padding-input');
      const spacingInput = document.getElementById('spacing-input');
      const columnSpacingInput = document.getElementById('column-spacing-input');
      const groupSpacingInput = document.getElementById('group-spacing-input');
      const annotationSpacingInput = document.getElementById('annotation-spacing-input');
      
      const padding = parseInt(paddingInput ? paddingInput.value : '40') || 40;
      const spacing = parseInt(spacingInput ? spacingInput.value : '20') || 20;
      const columnSpacing = parseInt(columnSpacingInput ? columnSpacingInput.value : '40') || 40;
      const groupSpacing = parseInt(groupSpacingInput ? groupSpacingInput.value : '80') || 80;
      const groupsPerRow = parseInt(document.getElementById('groups-per-row-input').value) || 3;
      const columnDirection = document.querySelector('input[name="column-direction"]:checked').value;
      const groupProperties = getSelectedGroupProperties();
      const columnProperty = document.getElementById('column-property-select').value;
      const showAnnotations = document.getElementById('show-annotations-checkbox').checked;
      const annotationSpacing = parseInt(annotationSpacingInput ? annotationSpacingInput.value : '24') || 24;
      const sortingOrder = getSortingOrderFromUI();
      const propertyNamesVisibility = getPropertyNamesVisibilityFromUI();
      const annotationTypes = getAnnotationTypesFromUI();
      
      parent.postMessage({ 
        pluginMessage: { 
          type: 'copy-preset',
          componentName: window.currentComponentName || 'Unknown Component',
          settings: {
            padding: padding,
            spacing: spacing,
            columnSpacing: columnSpacing,
            groupSpacing: groupSpacing,
            groupsPerRow: groupsPerRow,
            columnDirection: columnDirection,
            groupProperties: groupProperties,
            columnProperty: columnProperty === 'none' ? null : columnProperty,
            showAnnotations: showAnnotations,
            annotationSpacing: annotationSpacing,
            sortingOrder: sortingOrder,
            propertyNamesVisibility: propertyNamesVisibility,
            annotationTypes: annotationTypes
          }
        } 
      }, '*');
    });
    
    document.getElementById('cancel-btn').addEventListener('click', () => {
      parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*');
    });
    
    document.getElementById('refresh-properties-btn').addEventListener('click', () => {
      parent.postMessage({ pluginMessage: { type: 'get-properties' } }, '*');
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
    document.querySelectorAll('input[name="platform"]').forEach(radio => {
      radio.addEventListener('change', () => {
        // –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–µ–∫—É—â–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–æ–π, –∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
        if (window.currentComponentName && radio.checked) {
          loadPresetForPlatform(window.currentComponentName, radio.value);
        }
      });
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
    document.getElementById('use-custom-sorting-checkbox').addEventListener('change', (e) => {
      const sortingSection = document.getElementById('sorting-order-section');
      if (e.target.checked) {
        sortingSection.style.display = 'block';
        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
        if (hasValidSelection) {
          parent.postMessage({ pluginMessage: { type: 'get-property-values' } }, '*');
        } else {
          // –ï—Å–ª–∏ –Ω–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
          const container = document.getElementById('sorting-properties-list');
          container.innerHTML = '<div class="group-info">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</div>';
        }
      } else {
        sortingSection.style.display = 'none';
      }
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –ø–ª–∞–≥–∏–Ω–∞
    window.addEventListener('message', (event) => {
      const msg = event.data.pluginMessage;
      if (msg && msg.type === 'selection-updated') {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫ –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
        window.currentComponentName = msg.data.componentSetName;
        updateSelectionInfo(msg.data);
        
        // –ï—Å–ª–∏ –∫–∞—Å—Ç–æ–º–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞, –æ–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
        // –ù–û —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∑–∞—Ç–∏—Ä–∞–Ω–∏—è)
        if (document.getElementById('use-custom-sorting-checkbox').checked && msg.data.hasValidSelection) {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
          const hasSavedSortingOrder = msg.data.savedSettings && msg.data.savedSettings.sortingOrder && 
                                      Object.keys(msg.data.savedSettings.sortingOrder).length > 0;
          
          if (!hasSavedSortingOrder) {
            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            parent.postMessage({ pluginMessage: { type: 'get-property-values' } }, '*');
          }
        }
      }
      if (msg && msg.type === 'preset-for-platform-updated') {
        if (msg.preset) {
          loadSettingsToUI(msg.preset);
        }
      }
      if (msg && msg.type === 'property-values-updated') {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (–∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫)
        if (window.pendingSortingOrder && Object.keys(window.pendingSortingOrder).length > 0) {
          // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
          updateSortingOrderUI(window.pendingSortingOrder);
          // –û—á–∏—â–∞–µ–º –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
          window.pendingSortingOrder = null;
        } else if (msg.propertyValues && Object.keys(msg.propertyValues).length > 0) {
          // –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Å–≤–æ–π—Å—Ç–≤ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö
          const baseSortingOrder = {};
          Object.keys(msg.propertyValues).forEach(property => {
            baseSortingOrder[property] = {};
            // –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫ (1, 2, 3...) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
            msg.propertyValues[property].forEach((value, index) => {
              baseSortingOrder[property][value] = index + 1;
            });
          });
          updateSortingOrderUI(baseSortingOrder);
        } else {
          // –ï—Å–ª–∏ —Å–≤–æ–π—Å—Ç–≤ –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
          const container = document.getElementById('sorting-properties-list');
          container.innerHTML = '<div class="group-info">–£ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω–µ—Ç —Å–≤–æ–π—Å—Ç–≤ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</div>';
        }
      }
      if (msg && msg.type === 'preset-copied') {
        // –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–¥ –ø—Ä–µ—Å–µ—Ç–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(msg.presetCode).then(() => {
            console.log('–ü—Ä–µ—Å–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:', msg.componentName);
          }).catch(err => {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞:', err);
            // Fallback: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–¥ –≤ alert –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
            alert('–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ presets.js:\n\n' + msg.presetCode);
          });
        } else {
          // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
          const textArea = document.createElement('textarea');
          textArea.value = msg.presetCode;
          document.body.appendChild(textArea);
          textArea.select();
          try {
            document.execCommand('copy');
            console.log('–ü—Ä–µ—Å–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ (fallback) –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:', msg.componentName);
          } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ (fallback):', err);
            alert('–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ presets.js:\n\n' + msg.presetCode);
          }
          document.body.removeChild(textArea);
        }
      }
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ComboInput –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
    document.addEventListener('DOMContentLoaded', () => {
      // –°–æ–∑–¥–∞–µ–º ComboInput –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è
      const comboInputs = [
        { containerId: 'padding-input-container', inputId: 'padding-input', defaultValue: '40', placeholder: '40' },
        { containerId: 'spacing-input-container', inputId: 'spacing-input', defaultValue: '20', placeholder: '20' },
        { containerId: 'column-spacing-input-container', inputId: 'column-spacing-input', defaultValue: '40', placeholder: '40' },
        { containerId: 'group-spacing-input-container', inputId: 'group-spacing-input', defaultValue: '80', placeholder: '80' },
        { containerId: 'annotation-spacing-input-container', inputId: 'annotation-spacing-input', defaultValue: '24', placeholder: '24' }
      ];
      
      comboInputs.forEach(config => {
        const container = document.getElementById(config.containerId);
        if (container) {
          const comboInput = createComboInput(config.inputId, config.defaultValue, config.placeholder);
          container.appendChild(comboInput);
          setupComboInputEvents(comboInput);
        }
      });
    });
    
    // –ï—Å–ª–∏ DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ä–∞–∑—É
    if (document.readyState === 'loading') {
      // DOM –µ—â–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
    } else {
      // DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω
      setTimeout(() => {
        const comboInputs = [
          { containerId: 'padding-input-container', inputId: 'padding-input', defaultValue: '40', placeholder: '40' },
          { containerId: 'spacing-input-container', inputId: 'spacing-input', defaultValue: '20', placeholder: '20' },
          { containerId: 'column-spacing-input-container', inputId: 'column-spacing-input', defaultValue: '40', placeholder: '40' },
          { containerId: 'group-spacing-input-container', inputId: 'group-spacing-input', defaultValue: '80', placeholder: '80' },
          { containerId: 'annotation-spacing-input-container', inputId: 'annotation-spacing-input', defaultValue: '24', placeholder: '24' }
        ];
        
        comboInputs.forEach(config => {
          const container = document.getElementById(config.containerId);
          if (container && !container.hasChildNodes()) {
            const comboInput = createComboInput(config.inputId, config.defaultValue, config.placeholder);
            container.appendChild(comboInput);
            setupComboInputEvents(comboInput);
          }
        });
      }, 100);
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞ –¥–ª—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –æ–±—ã—á–Ω—ã—Ö input –ø–æ–ª–µ–π
    const inputs = document.querySelectorAll('.setting-input');
    inputs.forEach(input => {
      input.addEventListener('input', (e) => {
        const value = parseInt(e.target.value);
        
        if (e.target.id === 'groups-per-row-input') {
          if (value < 1) e.target.value = 1;
          if (value > 10) e.target.value = 10;
        }
      });
    });
  </script>
</body>
</html> 