<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</title>
  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 16px;
      background: #ffffff;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .title {
      font-size: 14px;
      font-weight: 600;
      color: #000000;
      margin: 0;
    }
    
    .description {
      font-size: 12px;
      color: #666666;
      margin: 0;
      line-height: 1.4;
    }
    
    .selection-info {
      background: #f0f7ff;
      border: 1px solid #b3d9ff;
      border-radius: 6px;
      padding: 12px;
      font-size: 12px;
    }
    
    .selection-info.no-selection {
      background: #fff7f0;
      border-color: #ffcc99;
    }
    
    .selection-info.no-selection .info-title {
      color: #cc6600;
    }
    
    .info-title {
      font-weight: 600;
      color: #0066cc;
      margin-bottom: 4px;
    }
    
    .info-details {
      color: #666666;
      font-size: 11px;
    }
    
    .settings {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .setting-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .setting-label {
      font-size: 12px;
      font-weight: 500;
      color: #333333;
    }
    
    .setting-input, .setting-select {
      padding: 8px 12px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      font-size: 12px;
      background: #ffffff;
      outline: none;
      transition: border-color 0.2s;
    }
    
    .setting-input:focus, .setting-select:focus {
      border-color: #0d99ff;
    }
    
    .setting-select {
      cursor: pointer;
    }
    
    .setting-select:disabled {
      background: #f5f5f5;
      color: #999999;
      cursor: not-allowed;
    }
    
    .grouping-section {
      background: #f9f9f9;
      border-radius: 6px;
      padding: 12px;
      border: 1px solid #e0e0e0;
    }
    
    .grouping-section.disabled {
      opacity: 0.6;
    }
    
    .section-title {
      font-size: 12px;
      font-weight: 600;
      color: #333333;
      margin-bottom: 8px;
    }
    
    .refresh-btn {
      padding: 4px 8px;
      background: #f0f0f0;
      border: 1px solid #d0d0d0;
      border-radius: 4px;
      font-size: 11px;
      cursor: pointer;
      color: #666666;
      margin-left: 8px;
      transition: background-color 0.2s;
    }
    
    .refresh-btn:hover {
      background: #e0e0e0;
    }
    
    .refresh-btn:disabled {
      background: #f8f8f8;
      color: #cccccc;
      cursor: not-allowed;
    }
    
    .features {
      background: #f7f7f7;
      border-radius: 6px;
      padding: 12px;
      font-size: 12px;
      color: #333333;
    }
    
    .feature {
      margin: 4px 0;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .feature::before {
      content: "‚úì";
      color: #00aa00;
      font-weight: bold;
    }
    
    .buttons {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }
    
    .button {
      flex: 1;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .button-primary {
      background: #0d99ff;
      color: white;
    }
    
    .button-primary:hover {
      background: #0b7ce6;
    }
    
    .button-primary:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }
    
    .button-secondary {
      background: #f0f0f0;
      color: #333333;
    }
    
    .button-secondary:hover {
      background: #e0e0e0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title">–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞</h1>
    
    <p class="description">
      –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–±–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (Component Set) –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ –Ω–∞–±–æ—Ä–∞, 
      –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –Ω–∞–∂–º–∏—Ç–µ "–í—ã—Ä–æ–≤–Ω—è—Ç—å".
    </p>
    
    <div class="selection-info" id="selection-info">
      <div class="info-title" id="info-title">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç</div>
      <div class="info-details" id="info-details">–í—ã–¥–µ–ª–∏—Ç–µ Component Set –∏–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ –Ω–∞–±–æ—Ä–∞</div>
    </div>
    
    <div class="settings">
      <div class="setting-group">
        <label class="setting-label" for="padding-input">–ü–∞–¥–¥–∏–Ω–≥ (px):</label>
        <input 
          type="number" 
          id="padding-input" 
          class="setting-input" 
          value="40" 
          min="0" 
          max="200"
          placeholder="40"
        >
      </div>
      
      <div class="setting-group">
        <label class="setting-label" for="spacing-input">–û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ (px):</label>
        <input 
          type="number" 
          id="spacing-input" 
          class="setting-input" 
          value="20" 
          min="0" 
          max="200"
          placeholder="20"
        >
      </div>
      
      <div class="setting-group">
        <label class="setting-label" for="columns-input">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫:</label>
        <input 
          type="number" 
          id="columns-input" 
          class="setting-input" 
          value="2" 
          min="1" 
          max="10"
          placeholder="2"
        >
      </div>
    </div>
    
    <div class="grouping-section" id="grouping-section">
      <div class="section-title">
        –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–≤–æ–π—Å—Ç–≤–∞–º
        <button class="refresh-btn" id="refresh-properties-btn" disabled>–û–±–Ω–æ–≤–∏—Ç—å</button>
      </div>
      
      <div class="setting-group">
        <label class="setting-label" for="group-property-select">–°–≤–æ–π—Å—Ç–≤–æ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏:</label>
        <select id="group-property-select" class="setting-select" disabled>
          <option value="none">–ë–µ–∑ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ (—Å–µ—Ç–∫–∞)</option>
        </select>
      </div>
    </div>
    
    <div class="features">
      <div class="feature">Grid layout —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏</div>
      <div class="feature">–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–≤–æ–π—Å—Ç–≤–∞–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞</div>
      <div class="feature">–°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤–Ω—É—Ç—Ä–∏ –≥—Ä—É–ø–ø</div>
      <div class="feature">–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä Component Set</div>
    </div>
    
    <div class="buttons">
      <button class="button button-primary" id="align-btn" disabled>–í—ã—Ä–æ–≤–Ω—è—Ç—å</button>
      <button class="button button-secondary" id="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>

  <script>
    let availableProperties = [];
    let hasValidSelection = false;
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤—ã–¥–µ–ª–µ–Ω–∏–∏
    function updateSelectionInfo(data) {
      const infoContainer = document.getElementById('selection-info');
      const infoTitle = document.getElementById('info-title');
      const infoDetails = document.getElementById('info-details');
      const groupingSection = document.getElementById('grouping-section');
      const alignBtn = document.getElementById('align-btn');
      const refreshBtn = document.getElementById('refresh-properties-btn');
      const propertySelect = document.getElementById('group-property-select');
      
      hasValidSelection = data.hasValidSelection;
      
      if (data.hasValidSelection) {
        infoContainer.className = 'selection-info';
        infoTitle.textContent = `üì¶ ${data.componentSetName}`;
        infoDetails.textContent = `${data.variantCount} –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ ‚Ä¢ ${data.properties.length} —Å–≤–æ–π—Å—Ç–≤`;
        
        groupingSection.classList.remove('disabled');
        alignBtn.disabled = false;
        refreshBtn.disabled = false;
        propertySelect.disabled = false;
        
        updatePropertiesSelect(data.properties);
      } else {
        infoContainer.className = 'selection-info no-selection';
        infoTitle.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç';
        infoDetails.textContent = '–í—ã–¥–µ–ª–∏—Ç–µ Component Set –∏–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ –Ω–∞–±–æ—Ä–∞';
        
        groupingSection.classList.add('disabled');
        alignBtn.disabled = true;
        refreshBtn.disabled = true;
        propertySelect.disabled = true;
        
        updatePropertiesSelect([]);
      }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å–≤–æ–π—Å—Ç–≤
    function updatePropertiesSelect(properties) {
      const select = document.getElementById('group-property-select');
      
      // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–π –æ–ø—Ü–∏–∏
      while (select.children.length > 1) {
        select.removeChild(select.lastChild);
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –æ–ø—Ü–∏–∏
      properties.forEach(property => {
        const option = document.createElement('option');
        option.value = property;
        option.textContent = `${property} (–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º)`;
        select.appendChild(option);
      });
      
      availableProperties = properties;
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    document.getElementById('align-btn').addEventListener('click', () => {
      if (!hasValidSelection) {
        return;
      }
      
      const padding = parseInt(document.getElementById('padding-input').value) || 40;
      const spacing = parseInt(document.getElementById('spacing-input').value) || 20;
      const columns = parseInt(document.getElementById('columns-input').value) || 2;
      const groupByProperty = document.getElementById('group-property-select').value;
      
      parent.postMessage({ 
        pluginMessage: { 
          type: 'align-variants',
          padding: padding,
          spacing: spacing,
          columns: columns,
          groupByProperty: groupByProperty === 'none' ? null : groupByProperty
        } 
      }, '*');
    });
    
    document.getElementById('cancel-btn').addEventListener('click', () => {
      parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*');
    });
    
    document.getElementById('refresh-properties-btn').addEventListener('click', () => {
      parent.postMessage({ pluginMessage: { type: 'get-properties' } }, '*');
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –ø–ª–∞–≥–∏–Ω–∞
    window.addEventListener('message', (event) => {
      const msg = event.data.pluginMessage;
      if (msg && msg.type === 'selection-updated') {
        updateSelectionInfo(msg.data);
      }
      // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
      if (msg && msg.type === 'properties') {
        updatePropertiesSelect(msg.data);
      }
    });
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞
    const inputs = document.querySelectorAll('.setting-input');
    inputs.forEach(input => {
      input.addEventListener('input', (e) => {
        const value = parseInt(e.target.value);
        
        if (e.target.id === 'columns-input') {
          if (value < 1) e.target.value = 1;
          if (value > 10) e.target.value = 10;
        } else {
          if (value < 0) e.target.value = 0;
          if (value > 200) e.target.value = 200;
        }
      });
    });
  </script>
</body>
</html> 