# Плагин "Выравнивание вариантов компонента"

Простой плагин для Figma, который автоматически выравнивает варианты компонента с настраиваемыми параметрами.

## Функциональность

Плагин берет выбранный набор компонентов (Component Set) и применяет к нему следующие настройки:
- **Настраиваемый паддинг**: от 0 до 200px (по умолчанию 40px)
- **Настраиваемый отступ между вариантами**: от 0 до 200px (по умолчанию 20px)
- **Количество колонок**: от 1 до 10 (по умолчанию 2)
- **Группировка по свойствам**: автоматическая группировка вариантов по выбранному свойству
- **Синхронная сортировка**: одинаковый порядок элементов во всех группах
- **Выравнивание**: Grid layout с равномерным распределением в сетке или по группам
- **Стилизованные аннотации**: подписи к вариантам и группам с кастомными стилями
- **Сохранение настроек**: автоматическое сохранение и восстановление настроек для каждого компонента

## Как использовать

1. Откройте файл в Figma
2. Выберите набор компонентов (Component Set) или отдельный компонент внутри набора
3. Запустите плагин через меню "Plugins"
4. Настройте параметры: паддинг, отступ и количество колонок
5. **Выберите свойство для группировки** (опционально):
   - Нажмите "Обновить" для получения доступных свойств
   - Выберите свойство из списка (например: "Size", "State", "Type")
   - Или оставьте "Без группировки" для обычной сетки
6. **Настройте направление колонок**:
   - "По горизонтали" - колонки располагаются горизонтально, аннотации сверху
   - "По вертикали" - колонки располагаются вертикально, аннотации слева
7. **Включите аннотации** (опционально):
   - Отметьте чекбокс "Показывать аннотации"
   - Будут добавлены стилизованные подписи к вариантам и группам
   - Позиционирование аннотаций зависит от выбранного направления колонок
8. Нажмите кнопку "Выровнять"

### Сохранение настроек:
- **Автоматическое сохранение**: все настройки автоматически сохраняются для каждого ComponentSet при применении
- **Восстановление при выборе**: при выборе компонента, к которому уже применялся плагин, все его настройки загружаются автоматически  
- **Индикатор статуса**: в информации о компоненте отображается "настройки сохранены" или "новый компонент"
- **Настройки по умолчанию**: для новых компонентов используются стандартные значения

### Примеры группировки:
- **Size**: все "Small" в первой колонке, "Medium" во второй, "Large" в третьей
- **State**: все "Default" в первой колонке, "Hover" во второй, "Disabled" в третьей
- **Type**: все "Primary" в первой колонке, "Secondary" во второй

### Синхронная сортировка:
При группировке по одному свойству, элементы в каждой колонке автоматически сортируются одинаково по остальным свойствам.

**Пример:** Группировка по "Size", сортировка по "State" + "Filled":
```
Колонка 1 (Large):          Колонка 2 (Medium):         Колонка 3 (Small):
• State=Default, Filled=True  • State=Default, Filled=True  • State=Default, Filled=True
• State=Hover, Filled=True    • State=Hover, Filled=True    • State=Hover, Filled=True
• State=ReadOnly, Filled=False • State=ReadOnly, Filled=False • State=ReadOnly, Filled=False
```

**Эталонный порядок создается автоматически:**
1. `Filled:True|State:Default`
2. `Filled:True|State:Hover`  
3. `Filled:False|State:ReadOnly`

Этот порядок применяется ко всем группам, обеспечивая консистентность.

## Возможности

### ✓ Редактируемые параметры
- Поля ввода для паддинга и отступа (0-200px)
- Настройка количества колонок (1-10)
- Значения по умолчанию: паддинг 40px, отступ 20px, 2 колонки

### ✓ Группировка по свойствам
- Автоматическое определение доступных свойств вариантов (Size, State, Type и др.)
- Группировка компонентов по выбранному свойству в отдельные колонки
- Каждая колонка содержит варианты с одинаковым значением свойства
- Автоматическое определение количества колонок по количеству уникальных значений

### ✓ Синхронная сортировка
- Единый порядок элементов во всех группах на основе остальных свойств
- Автоматическое создание эталонного порядка сортировки
- Консистентное позиционирование: одинаковые комбинации свойств в одинаковых позициях
- Алфавитная сортировка ключей свойств для предсказуемого результата

### ✓ Grid Layout система
- Автоматическое позиционирование компонентов в сетке
- Равномерное распределение по колонкам и строкам (обычный режим)
- Вертикальное выравнивание в колонках (режим группировки)
- Автоматический расчет размеров на основе самого большого компонента

### ✓ Адаптивный размер
- Автоматический расчет размера Component Set
- Учет паддинга и отступов между компонентами
- Оптимальное соотношение ширины и высоты

### ✓ Стилизованные аннотации
- **Адаптивное позиционирование** в зависимости от направления колонок:
  - **Горизонтальное направление**: все аннотации сверху от компонентов
  - **Вертикальное направление**: все аннотации слева от компонентов
- Названия вариантов (цвет #7B29E5, выравнивание справа)
- Названия групп и колонок (фон #7B29E5, белый текст, скругленные углы)
- Размер по содержимому (hug content) для компактности
- Шрифт SB Sans Text (с фолбэком на Inter/Roboto)
- Размер 14px, насыщенность 500, межстрочный интервал 18px
- Отрицательный letter-spacing -0.28px для улучшенной читаемости
- Учет переносов строк при размещении групп

### ✓ Сохранение настроек
- Автоматическое сохранение настроек для каждого ComponentSet
- При повторном выборе компонента загружаются последние использованные настройки
- Настройки сохраняются в файле Figma и синхронизируются с командой
- Для новых компонентов используются настройки по умолчанию
- Визуальный индикатор статуса настроек в интерфейсе

### ✓ Улучшенный интерфейс
- Современный дизайн в стиле Figma
- Понятные элементы управления
- Опция включения/выключения аннотаций
- Список применяемых функций

## Технические детали

Плагин использует Grid layout для позиционирования вариантов:

### Grid система:
- `layoutMode`: 'NONE' - отключение Auto Layout
- **Позиционирование**: компоненты размещаются по координатам
- **Размеры ячеек**: определяются размерами самого большого компонента
- **Размер контейнера**: автоматически рассчитывается на основе содержимого

### Режим обычной сетки:
- **Колонка**: `index % columns`
- **Строка**: `Math.floor(index / columns)`
- **Позиция X**: `padding + col * (maxWidth + spacing)`
- **Позиция Y**: `padding + row * (maxHeight + spacing)`

### Режим группировки по свойствам:
- **Анализ свойств**: `variant.variantProperties` для получения всех доступных свойств
- **Группировка**: компоненты с одинаковым значением свойства попадают в одну группу
- **Позиционирование**: 
  - `x = padding + groupIndex * (maxWidth + spacing)` (колонка = группа)
  - `y = padding + itemIndex * (maxHeight + spacing)` (строка = позиция в группе)
- **Количество колонок**: автоматически определяется по количеству уникальных значений

### Алгоритм группировки с синхронной сортировкой:
```javascript
// 1. Группировка вариантов
const groups = {};
variants.forEach(variant => {
  const value = variant.variantProperties[property];
  if (!groups[value]) groups[value] = [];
  groups[value].push(variant);
});

// 2. Создание эталонного порядка сортировки
function createSortingKey(variant, excludeProperty) {
  const sortingProperties = Object.keys(variant.variantProperties)
    .filter(prop => prop !== excludeProperty)
    .sort(); // Алфавитная сортировка свойств
    
  return sortingProperties
    .map(prop => `${prop}:${variant.variantProperties[prop]}`)
    .join('|'); // Например: "State:Default|Filled:True"
}

const referenceSortingOrder = Array.from(new Set(
  variants.map(v => createSortingKey(v, groupByProperty))
)).sort();

// 3. Сортировка каждой группы по эталонному порядку
Object.keys(groups).forEach(groupKey => {
  groups[groupKey].sort((a, b) => {
    const keyA = createSortingKey(a, groupByProperty);
    const keyB = createSortingKey(b, groupByProperty);
    return referenceSortingOrder.indexOf(keyA) - referenceSortingOrder.indexOf(keyB);
  });
});

// 4. Позиционирование по группам
Object.keys(groups).forEach((groupKey, groupIndex) => {
  groups[groupKey].forEach((variant, itemIndex) => {
    variant.x = padding + groupIndex * (maxWidth + spacing);
    variant.y = padding + itemIndex * (maxHeight + spacing);
  });
});
```

## Файлы

- `code.js` - основная логика плагина с Grid layout и группировкой по свойствам
- `ui.html` - пользовательский интерфейс с настройками и выбором свойств
- `manifest.json` - конфигурация плагина
- `README.md` - документация с примерами использования 